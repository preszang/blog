<html>
<head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>python+selenium自动化UI测试基本教程 | 霜序五</title>

<link rel="shortcut icon" href="https://preszang.github.io/favicon.ico?v=1612774371273">

<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://preszang.github.io/styles/main.css">
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"> -->

<style>
    hr {
        margin-top: 1rem;
        margin-bottom: 1rem;
        border: 0;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }
</style>

<script src="https://cdn.jsdelivr.net/npm/@highlightjs/cdn-assets/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js"></script> -->
<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <style>
    /* 导航栏样式 */
    .navbar {
        position: relative;
        display: -ms-flexbox;
        display: flex;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
        -ms-flex-align: center;
        align-items: center;
        -ms-flex-pack: justify;
        justify-content: space-between;
        padding: 0.5rem 1rem;
    }

    .navbar-brand {
        display: inline-block;
        padding-top: 0.3125rem;
        padding-bottom: 0.3125rem;
        margin-right: 1rem;
        font-size: 1.25rem;
        line-height: inherit;
        white-space: nowrap;
    }

    .navbar-brand:hover,
    .navbar-brand:focus {
        text-decoration: none;
    }

    .navbar-nav {
        display: -ms-flexbox;
        display: flex;
        -ms-flex-direction: column;
        flex-direction: column;
        padding-left: 0;
        margin-bottom: 0;
        list-style: none;
    }

    .navbar-collapse {
        -ms-flex-preferred-size: 100%;
        flex-basis: 100%;
        -ms-flex-positive: 1;
        flex-grow: 1;
        -ms-flex-align: center;
        align-items: center;
    }

    .navbar-toggler {
        padding: 0.25rem 0.75rem;
        font-size: 1.25rem;
        line-height: 1;
        background-color: transparent;
        border: 1px solid transparent;
        border-radius: 0.25rem;
    }

    .navbar-toggler:hover,
    .navbar-toggler:focus {
        text-decoration: none;
    }

    @media (min-width: 992px) {
        .navbar-expand-lg {
            -ms-flex-flow: row nowrap;
            flex-flow: row nowrap;
            -ms-flex-pack: start;
            justify-content: flex-start;
        }

        .navbar-expand-lg .navbar-nav {
            -ms-flex-direction: row;
            flex-direction: row;
        }

        .navbar-expand-lg .navbar-collapse {
            display: -ms-flexbox !important;
            display: flex !important;
            -ms-flex-preferred-size: auto;
            flex-basis: auto;
        }

        .navbar-expand-lg .navbar-toggler {
            display: none;
        }
    }

    @media (max-width: 991px) {
        #navbarSupportedContent {
            display: none;
        }
    }
</style>
<nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="头像">
        <div class="site-name gt-c-content-color-first">
            霜序五
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
            <div class="nav-item">
                
                <a href="/" class="menu gt-a-link">
                    首页
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/archives" class="menu gt-a-link">
                    归档
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/tags" class="menu gt-a-link">
                    标签
                </a>
                
            </div>
            
            <div class="nav-item">
                
                <a href="/post/about" class="menu gt-a-link">
                    关于
                </a>
                
            </div>
            
        </div>
        <div style="text-align: center">
            <form id="gridea-search-form" style="position: relative" data-update="1612774371273"
                action="/search/index.html">
                <input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="搜索文章" />
                <i class="fas fa-search gt-c-content-color-first" style="position: absolute; top: 9px; left: 10px;"></i>
            </form>
        </div>
    </div>
</nav>
<script>
    /* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = function () {
        var element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else {
            element.style.display = 'none';
        }
    }
</script>
    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    python+selenium自动化UI测试基本教程
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        · 2021-02-08 ·
                    </time>
                    
                        <a href="https://preszang.github.io/tag/ruan-jian-ce-shi/" class="post-tags">
                            # 软件测试
                        </a>
                    
                </div>
                <div class="post-content">
                    <h3 id="一-安装selenium">一、安装selenium</h3>
<h4 id="1-安装python">1. 安装python</h4>
<blockquote>
<p>打开 <a href="https://www.python.org/">Python官网</a>，找到<code>Download</code>, 安装最新版python，python 的安装方法再此不详细介绍了。</p>
</blockquote>
<h4 id="2-安装selenium">2. 安装selenium</h4>
<hr>
<ol>
<li>确保pip命令可用，如果提示“pip不是内部或外部命令”，需要将将pip的安装目录添加到环境变量PATH下面。</li>
<li>接下来通过pip命令安装Selenium:</li>
</ol>
<pre><code>pip install selenium
</code></pre>
<pre><code>Collecting selenium
  Downloading selenium-3.4.3-py2.py3-none-any.whl (931kB)
    26% |████████                       | 245kB 576kB/s eta 0:00:02    
    27% |█████████                      | 256kB 570kB/s eta 0:00:02    
    28% |██████████                     | 266kB 536kB/s eta 0:00:0    
    29% |███████████                    | 276kB 530kB/s eta 0:00:0    
    30% |████████████                   | 286kB 586kB/s eta 0:00:0
……
</code></pre>
<blockquote>
<p>打开编辑器，输入以下代码，如果执行报错，请看下一节</p>
</blockquote>
<pre><code>from selenium import webdriver

driver = webdriver.Chrome()
driver.get('https://www.baidu.com')

print(driver.title)

driver.quit()
</code></pre>
<h3 id="二-selenium3-浏览器驱动">二、selenium3 浏览器驱动</h3>
<h4 id="下载浏览器驱动">下载浏览器驱动</h4>
<p>当selenium升级到3.0之后，对不同的浏览器驱动进行了规范。如果想使用selenium驱动不同的浏览器，必须单独下载并设置不同的浏览器驱动。（注：部分浏览器驱动地址需要科学上网。）</p>
<blockquote>
<ul>
<li>Firefox浏览器驱动：<a href="https://github.com/mozilla/geckodriver/releases">geckodriver</a></li>
<li>Chrome浏览器驱动：<a href="https://sites.google.com/a/chromium.org/chromedriver/home">chromedriver</a> , <a href="https://npm.taobao.org/mirrors/chromedriver">taobao备用地址[常用]</a></li>
<li>IE浏览器驱动：<a href="http://selenium-release.storage.googleapis.com/index.html">IEDriverServer</a></li>
<li>Edge浏览器驱动：<a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver">MicrosoftWebDriver</a></li>
<li>Opera浏览器驱动：<a href="https://github.com/operasoftware/operachromiumdriver/releases">operadriver</a></li>
<li>PhantomJS浏览器驱动：<a href="http://phantomjs.org/">phantomjs</a></li>
</ul>
</blockquote>
<h4 id="设置浏览器驱动">设置浏览器驱动</h4>
<p>设置浏览器的地址非常简单。 我们可以手动创建一个存放浏览器驱动的目录，如： C:\driver , 将下载的浏览器驱动文件（例如：chromedriver、geckodriver）丢到该目录下。</p>
<p>验证不同的浏览器驱动是否正常使用。</p>
<pre><code class="language-python">from selenium import webdriver

driver = webdriver.Firefox()   # Firefox浏览器
driver = webdriver.Chrome()    # Chrome浏览器
driver = webdriver.Ie()        # Internet Explorer浏览器
driver = webdriver.Edge()      # Edge浏览器
driver = webdriver.Opera()     # Opera浏览器
driver = webdriver.PhantomJS()   # PhantomJS
</code></pre>
<h3 id="三-selenium元素定位">三、selenium元素定位</h3>
<h4 id="selenium定位方法">selenium定位方法</h4>
<p>Selenium提供了8种定位方式。</p>
<ul>
<li>id、name、class name、tag name、link text、partial link text、xpath、css selector</li>
</ul>
<p>这8种定位方式在Python selenium中所对应的方法为：</p>
<ul>
<li>find_element_by_id()</li>
<li>find_element_by_name()</li>
<li>find_element_by_class_name()</li>
<li>find_element_by_tag_name()</li>
<li>find_element_by_link_text()</li>
<li>find_element_by_partial_link_text()</li>
<li>find_element_by_xpath()</li>
<li>find_element_by_css_selector()</li>
</ul>
<h4 id="定位方法的用法">定位方法的用法</h4>
<p>假如我们有一个Web页面，通过前端工具（如，Firebug）查看到一个元素的属性是这样的。</p>
<pre><code class="language-html">&lt;html&gt;
  &lt;head&gt;
  &lt;body link=&quot;#0000cc&quot;&gt;
    &lt;a id=&quot;result_logo&quot; href=&quot;/&quot; onmousedown=&quot;return c({'fm':'tab','tab':'logo'})&quot;&gt;
    &lt;form id=&quot;form&quot; class=&quot;fm&quot; name=&quot;f&quot; action=&quot;/s&quot;&gt;
      &lt;span class=&quot;soutu-btn&quot;&gt;&lt;/span&gt;
        &lt;input id=&quot;kw&quot; class=&quot;s_ipt&quot; name=&quot;wd&quot; value=&quot;&quot; maxlength=&quot;255&quot; autocomplete=&quot;off&quot;&gt;
</code></pre>
<p>我们的目的是要定位input标签的输入框。</p>
<ul>
<li>通过id定位:</li>
</ul>
<pre><code class="language-python">dr.find_element_by_id(&quot;kw&quot;)
</code></pre>
<ul>
<li>通过name定位:</li>
</ul>
<pre><code class="language-python">dr.find_element_by_name(&quot;wd&quot;)
</code></pre>
<ul>
<li>通过class name定位:</li>
</ul>
<pre><code class="language-python">dr.find_element_by_class_name(&quot;s_ipt&quot;)
</code></pre>
<ul>
<li>通过tag name定位:</li>
</ul>
<pre><code class="language-python">dr.find_element_by_tag_name(&quot;input&quot;)
</code></pre>
<ul>
<li>通过xpath定位，xpath定位有N种写法，这里列几个常用写法:</li>
</ul>
<pre><code class="language-python">dr.find_element_by_xpath(&quot;//*[@id='kw']&quot;)
dr.find_element_by_xpath(&quot;//*[@name='wd']&quot;)
dr.find_element_by_xpath(&quot;//input[@class='s_ipt']&quot;)
dr.find_element_by_xpath(&quot;/html/body/form/span/input&quot;)
dr.find_element_by_xpath(&quot;//span[@class='soutu-btn']/input&quot;)
dr.find_element_by_xpath(&quot;//form[@id='form']/span/input&quot;)
dr.find_element_by_xpath(&quot;//input[@id='kw' and @name='wd']&quot;)
</code></pre>
<ul>
<li>通过css定位，css定位有N种写法，这里列几个常用写法:</li>
</ul>
<pre><code class="language-python">dr.find_element_by_css_selector(&quot;#kw&quot;)
dr.find_element_by_css_selector(&quot;[name=wd]&quot;)
dr.find_element_by_css_selector(&quot;.s_ipt&quot;)
dr.find_element_by_css_selector(&quot;html &gt; body &gt; form &gt; span &gt; input&quot;)
dr.find_element_by_css_selector(&quot;span.soutu-btn&gt; input#kw&quot;)
dr.find_element_by_css_selector(&quot;form#form &gt; span &gt; input&quot;)
</code></pre>
<p>接下来，我们的页面上有一组文本链接。</p>
<pre><code class="language-python">&lt;a class=&quot;mnav&quot; href=&quot;http://news.baidu.com&quot; name=&quot;tj_trnews&quot;&gt;新闻&lt;/a&gt;
&lt;a class=&quot;mnav&quot; href=&quot;http://www.hao123.com&quot; name=&quot;tj_trhao123&quot;&gt;hao123&lt;/a&gt;
</code></pre>
<ul>
<li>通过link text定位:</li>
</ul>
<pre><code class="language-python">dr.find_element_by_link_text(&quot;新闻&quot;)
dr.find_element_by_link_text(&quot;hao123&quot;)
</code></pre>
<ul>
<li>通过link text定位:</li>
</ul>
<pre><code class="language-python">dr.find_element_by_partial_link_text(&quot;新&quot;)
dr.find_element_by_partial_link_text(&quot;hao&quot;)
dr.find_element_by_partial_link_text(&quot;123&quot;)
</code></pre>
<p>关于xpaht和css的定位比较复杂，请参考<a href="http://www.w3school.com.cn/xpath/xpath_syntax.asp">xpath语法</a>、<a href="http://www.w3school.com.cn/cssref/css_selectors.asp">css选择器</a></p>
<h3 id="四-控制浏览器操作">四、控制浏览器操作</h3>
<h4 id="控制浏览器窗口大小">控制浏览器窗口大小</h4>
<p>有时候我们希望能以某种浏览器尺寸打开，让访问的页面在这种尺寸下运行。例如可以将浏览器设置成移动端大小(480* 800)，然后访问移动站点，对其样式进行评估；WebDriver提供了set_window_size()方法来设置浏览器的大小。</p>
<pre><code class="language-python">from selenium import webdriver

driver = webdriver.Firefox()
driver.get(&quot;http://m.baidu.com&quot;)

# 参数数字为像素点
print(&quot;设置浏览器宽480、高800显示&quot;)
driver.set_window_size(480, 800)
driver.quit()
</code></pre>
<p>在PC端执行自动化测试脚本大多的情况下是希望浏览器在全屏幕模式下执行，那么可以使用maximize_window()方法使打开的浏览器全屏显示，其用法与set_window_size() 相同，但它不需要参数。</p>
<h4 id="控制浏览器后退-前进">控制浏览器后退、前进</h4>
<p>在使用浏览器浏览网页时，浏览器提供了后退和前进按钮，可以方便地在浏览过的网页之间切换，WebDriver也提供了对应的back()和forward()方法来模拟后退和前进按钮。下面通过例子来演示这两个方法的使用。</p>
<pre><code class="language-python">from selenium import webdriver

driver = webdriver.Firefox()

#访问百度首页
first_url= 'http://www.baidu.com'
print(&quot;now access %s&quot; %(first_url))
driver.get(first_url)

#访问新闻页面
second_url='http://news.baidu.com'
print(&quot;now access %s&quot; %(second_url))
driver.get(second_url)

#返回（后退）到百度首页
print(&quot;back to  %s &quot;%(first_url))
driver.back()

#前进到新闻页
print(&quot;forward to  %s&quot;%(second_url))
driver.forward()

driver.quit()
</code></pre>
<p>为了看清脚本的执行过程，下面每操作一步都通过print()来打印当前的URL地址。</p>
<h4 id="刷新页面">刷新页面</h4>
<pre><code class="language-python">driver.refresh() #刷新当前页面
</code></pre>
<h3 id="五-webdriver常用方法">五、WebDriver常用方法</h3>
<h4 id="点击和输入">点击和输入</h4>
<p>前面已经学习了定位元素， 定位只是第一步， 定位之后需要对这个元素进行操作， 或单击（按钮） 或输入（输入框） ， 下面就来认识 WebDriver 中最常用的几个方法：</p>
<ul>
<li>clear()： 清除文本。</li>
<li>send_keys (value)： 模拟按键输入。</li>
<li>click()： 单击元素。</li>
</ul>
<pre><code class="language-python">from selenium import webdriver

driver = webdriver.Chrome()
driver.get(&quot;https://www.baidu.com&quot;)

driver.find_element_by_id(&quot;kw&quot;).clear()
driver.find_element_by_id(&quot;kw&quot;).send_keys(&quot;selenium&quot;)
driver.find_element_by_id(&quot;su&quot;).click()

driver.quit()
</code></pre>
<h4 id="提交">提交</h4>
<p>submit()方法用于提交表单。 例如， 在搜索框输入关键字之后的“回车” 操作， 就可以通过该方法模拟。</p>
<pre><code class="language-python">from selenium import webdriver

driver = webdriver.Chrome()
driver.get(&quot;https://www.baidu.com&quot;)

search_text = driver.find_element_by_id('kw')
search_text.send_keys('selenium')
search_text.submit()

driver.quit()
</code></pre>
<p>有时候 submit()可以与 click()方法互换来使用， submit()同样可以提交一个按钮， 但 submit()的应用范围远不及 click()广泛。</p>
<h4 id="其他常用方法">其他常用方法</h4>
<ul>
<li>
<p>size： 返回元素的尺寸。</p>
</li>
<li>
<p>text： 获取元素的文本。</p>
</li>
<li>
<p>get_attribute(name)： 获得属性值。</p>
</li>
<li>
<p>is_displayed()： 设置该元素是否用户可见。</p>
</li>
</ul>
<pre><code class="language-python">from selenium import webdriver

driver = webdriver.Chrome()
driver.get(&quot;http://www.baidu.com&quot;)

# 获得输入框的尺寸
size = driver.find_element_by_id('kw').size
print(size)

# 返回百度页面底部备案信息
text = driver.find_element_by_id(&quot;cp&quot;).text
print(text)

# 返回元素的属性值， 可以是 id、 name、 type 或其他任意属性
attribute = driver.find_element_by_id(&quot;kw&quot;).get_attribute('type')
print(attribute)

# 返回元素的结果是否可见， 返回结果为 True 或 False
result = driver.find_element_by_id(&quot;kw&quot;).is_displayed()
print(result)

driver.quit()
</code></pre>
<p>输出结果：</p>
<pre><code class="language-python">{'width': 500, 'height': 22}
©2015 Baidu 使用百度前必读 意见反馈 京 ICP 证 030173 号
text
True
</code></pre>
<p>执行上面的程序并查看结果：</p>
<p><code>size</code> 方法用于获取百度输入框的宽、 高， text 方法用于获得百度底部的备案信息</p>
<p><code>get_attribute()</code>用于获得百度输入的 type 属性的值，</p>
<p><code>is_displayed()</code>用于返回一个元素是否可见， 如果可见则返回 <code>True</code>， 否则返回 <code>False</code>。</p>
<h3 id="六-鼠标事件">六、鼠标事件</h3>
<p>在 WebDriver 中， 将这些关于鼠标操作的方法封装在<code>ActionChains</code> 类提供。</p>
<p><code>ActionChains</code>类提供了鼠标操作的常用方法：</p>
<ul>
<li><code>perform()</code>： 执行所有 ActionChains 中存储的行为；</li>
<li><code>context_click()</code>： 右击；</li>
<li><code>double_click()</code>： 双击；</li>
<li><code>drag_and_drop()</code>： 拖动；</li>
<li><code>move_to_element()</code>： 鼠标悬停。</li>
</ul>
<h4 id="鼠标悬停操作">鼠标悬停操作</h4>
<pre><code class="language-python">from selenium import webdriver
# 引入 ActionChains 类
from selenium.webdriver.common.action_chains import ActionChains

driver = webdriver.Chrome()
driver.get(&quot;https://www.baidu.cn&quot;)

# 定位到要悬停的元素
above = driver.find_element_by_link_text(&quot;设置&quot;)
# 对定位到的元素执行鼠标悬停操作
ActionChains(driver).move_to_element(above).perform()
</code></pre>
<ul>
<li><code>from selenium.webdriver import ActionChains</code></li>
</ul>
<p>导入提供鼠标操作的 ActionChains 类。</p>
<ul>
<li><code>ActionChains(driver)</code></li>
</ul>
<p>调用 ActionChains()类， 将浏览器驱动 driver 作为参数传入。</p>
<ul>
<li><code>move_to_element(above)</code></li>
</ul>
<p>context_click()方法用于模拟鼠标右键操作， 在调用时需要指定元素定位。</p>
<ul>
<li><code>perform()</code></li>
</ul>
<p>执行所有 ActionChains 中存储的行为， 可以理解成是对整个操作的提交动作。</p>
<h3 id="七-键盘事件">七、键盘事件</h3>
<p>Keys()类提供了键盘上几乎所有按键的方法。</p>
<p>前面了解到， send_keys()方法可以用来模拟键盘输入， 除此 之外， 我们还可以用它来输入键盘上的按键， 甚至是组合键， 如 Ctrl+A、 Ctrl+C 等。</p>
<pre><code class="language-python">from selenium import webdriver
# 引入 Keys 模块
from selenium.webdriver.common.keys import Keys

driver = webdriver.Chrome()
driver.get(&quot;http://www.baidu.com&quot;)

# 输入框输入内容
driver.find_element_by_id(&quot;kw&quot;).send_keys(&quot;seleniumm&quot;)

# 删除多输入的一个 m
driver.find_element_by_id(&quot;kw&quot;).send_keys(Keys.BACK_SPACE)

# 输入空格键+“教程”
driver.find_element_by_id(&quot;kw&quot;).send_keys(Keys.SPACE)
driver.find_element_by_id(&quot;kw&quot;).send_keys(&quot;教程&quot;)

# ctrl+a 全选输入框内容
driver.find_element_by_id(&quot;kw&quot;).send_keys(Keys.CONTROL, 'a')

# ctrl+x 剪切输入框内容
driver.find_element_by_id(&quot;kw&quot;).send_keys(Keys.CONTROL, 'x')

# ctrl+v 粘贴内容到输入框
driver.find_element_by_id(&quot;kw&quot;).send_keys(Keys.CONTROL, 'v')

# 通过回车键来代替单击操作
driver.find_element_by_id(&quot;su&quot;).send_keys(Keys.ENTER)
driver.quit()
</code></pre>
<p>需要说明的是， 上面的脚本没有什么实际意义， 仅向我们展示模拟键盘各种按键与组合键的用法。</p>
<ul>
<li><code>from selenium.webdriver.common.keys import Keys</code></li>
</ul>
<p>在使用键盘按键方法前需要先导入 keys 类。</p>
<p>以下为常用的键盘操作：</p>
<ul>
<li>send_keys(Keys.BACK_SPACE) 删除键（BackSpace）</li>
<li>send_keys(Keys.SPACE) 空格键(Space)</li>
<li>send_keys(Keys.TAB) 制表键(Tab)</li>
<li>send_keys(Keys.ESCAPE) 回退键（Esc）</li>
<li>send_keys(Keys.ENTER) 回车键（Enter）</li>
<li>send_keys(Keys.CONTROL,'a') 全选（Ctrl+A）</li>
<li>send_keys(Keys.CONTROL,'c') 复制（Ctrl+C）</li>
<li>send_keys(Keys.CONTROL,'x') 剪切（Ctrl+X）</li>
<li>send_keys(Keys.CONTROL,'v') 粘贴（Ctrl+V）</li>
<li>send_keys(Keys.F1) 键盘 F1</li>
<li>send_keys(Keys.F12) 键盘 F12</li>
</ul>
<h3 id="八-获取断言信息">八、获取断言信息</h3>
<p>不管是在做功能测试还是自动化测试，最后一步需要拿实际结果与预期进行比较。这个比较的称之为断言。</p>
<p>我们通常可以通过获取title 、URL和text等信息进行断言。text方法在前面已经讲过，它用于获取标签对之间的文本信息。</p>
<p>下面同样以百度为例，介绍如何获取这些信息。</p>
<pre><code class="language-python">from selenium import webdriver
from time import sleep


driver = webdriver.Firefox()
driver.get(&quot;https://www.baidu.com&quot;)

print('Before search================')

# 打印当前页面title
title = driver.title
print(title)

# 打印当前页面URL
now_url = driver.current_url
print(now_url)

driver.find_element_by_id(&quot;kw&quot;).send_keys(&quot;selenium&quot;)
driver.find_element_by_id(&quot;su&quot;).click()
sleep(1)

print('After search================')

# 再次打印当前页面title
title = driver.title
print(title)

# 打印当前页面URL
now_url = driver.current_url
print(now_url)

# 获取结果数目
user = driver.find_element_by_class_name('nums').text
print(user)

driver.quit()
</code></pre>
<p>脚本运行结果如下：</p>
<pre><code class="language-bash">Before search================
百度一下，你就知道
https://www.baidu.com/
After search================
selenium_百度搜索
https://www.baidu.com/s?ie=utf-8&amp;f=8&amp;rsv_bp=0&amp;rsv_idx...
搜索工具
百度为您找到相关结果约5,380,000个
</code></pre>
<ul>
<li>title：用于获得当前页面的标题。</li>
<li>current_url：用户获得当前页面的URL。</li>
<li>text：获取搜索条目的文本信息。</li>
</ul>
<h3 id="九-设置元素等待">九、设置元素等待</h3>
<p>WebDriver提供了两种类型的等待：<strong>显式等待</strong>和<strong>隐式等待</strong>。</p>
<h4 id="显式等待">显式等待</h4>
<p>显式等待使WebdDriver等待某个条件成立时继续执行，否则在达到最大时长时抛出超时异常（TimeoutException）。</p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

driver = webdriver.Firefox()
driver.get(&quot;http://www.baidu.com&quot;)

element = WebDriverWait(driver, 5, 0.5).until(
                      EC.presence_of_element_located((By.ID, &quot;kw&quot;))
                      )
element.send_keys('selenium')
driver.quit()
</code></pre>
<p>WebDriverWait类是由WebDirver 提供的等待方法。在设置时间内，默认每隔一段时间检测一次当前页面元素是否存在，如果超过设置时间检测不到则抛出异常。具体格式如下：</p>
<pre><code class="language-python">WebDriverWait(driver, timeout, poll_frequency=0.5, ignored_exceptions=None)
</code></pre>
<ul>
<li>driver ：浏览器驱动。</li>
<li>timeout ：最长超时时间，默认以秒为单位。</li>
<li>poll_frequency ：检测的间隔（步长）时间，默认为0.5S。</li>
<li>ignored_exceptions ：超时后的异常信息，默认情况下抛NoSuchElementException异常。</li>
</ul>
<p>WebDriverWait()一般由until()或until_not()方法配合使用，下面是until()和until_not()方法的说明。</p>
<ul>
<li>until(method, message='')</li>
</ul>
<p>调用该方法提供的驱动程序作为一个参数，直到返回值为True。</p>
<ul>
<li>until_not(method, message='')</li>
</ul>
<p>调用该方法提供的驱动程序作为一个参数，直到返回值为False。</p>
<p>在本例中，通过as关键字将<code>expected_conditions</code> 重命名为EC，并调用<code>presence_of_element_located()</code>方法判断元素是否存在。</p>
<h4 id="隐式等待">隐式等待</h4>
<hr>
<blockquote>
<p>WebDriver提供了implicitly_wait()方法来实现隐式等待，默认设置为0。它的用法相对来说要简单得多。</p>
</blockquote>
<pre><code class="language-python">from selenium import webdriver
from selenium.common.exceptions import NoSuchElementException
from time import ctime

driver = webdriver.Firefox()

# 设置隐式等待为10秒
driver.implicitly_wait(10)
driver.get(&quot;http://www.baidu.com&quot;)

try:
    print(ctime())
    driver.find_element_by_id(&quot;kw22&quot;).send_keys('selenium')
except NoSuchElementException as e:
    print(e)
finally:
    print(ctime())
    driver.quit()
</code></pre>
<p><code>implicitly_wait()</code> 默认参数的单位为秒，本例中设置等待时长为10秒。首先这10秒并非一个固定的等待时间，它并不影响脚本的执行速度。其次，它并不针对页面上的某一元素进行等待。当脚本执行到某个元素定位时，如果元素可以定位，则继续执行；如果元素定位不到，则它将以轮询的方式不断地判断元素是否被定位到。假设在第6秒定位到了元素则继续执行，若直到超出设置时长（10秒）还没有定位到元素，则抛出异常。</p>
<h3 id="十-定位一组元素">十、定位一组元素</h3>
<p>WebDriver还提供了8种用于定位一组元素的方法。</p>
<pre><code class="language-python">find_elements_by_id()
find_elements_by_name()
find_elements_by_class_name()
find_elements_by_tag_name()
find_elements_by_link_text()
find_elements_by_partial_link_text()
find_elements_by_xpath()
find_elements_by_css_selector()
</code></pre>
<p>定位一组元素的方法与定位单个元素的方法类似，唯一的区别是在单词element后面多了一个s表示复数。</p>
<p>接下来通过例子演示定位一组元素的使用：</p>
<pre><code class="language-python">from selenium import webdriver
from time import sleep

driver = webdriver.Chrome()
driver.get(&quot;https://www.baidu.com&quot;)

driver.find_element_by_id(&quot;kw&quot;).send_keys(&quot;selenium&quot;)
driver.find_element_by_id(&quot;su&quot;).click()
sleep(1)

# 定位一组元素
texts = driver.find_elements_by_xpath('//div/h3/a')

# 循环遍历出每一条搜索结果的标题
for t in texts:
    print(t.text)
driver.quit()
</code></pre>
<h3 id="十一-多表单切换">十一、多表单切换</h3>
<p>在Web应用中经常会遇到frame/iframe表单嵌套页面的应用，WebDriver只能在一个页面上对元素识别与定位，对于frame/iframe表单内嵌页面上的元素无法直接定位。这时就需要通过switch_to.frame()方法将当前定位的主体切换为frame/iframe表单的内嵌页面中。</p>
<pre><code class="language-html">&lt;html&gt;
  &lt;body&gt;
    ...
    &lt;iframe id=&quot;x-URS-iframe&quot; ...&gt;
      &lt;html&gt;
         &lt;body&gt;
           ...
           &lt;input name=&quot;email&quot; &gt;
</code></pre>
<p>126邮箱登录框的结构大概是这样子的，想要操作登录框必须要先切换到iframe表单。</p>
<pre><code class="language-python">from selenium import webdriver

driver = webdriver.Chrome()
driver.get(&quot;http://www.126.com&quot;)

driver.switch_to.frame('x-URS-iframe')
driver.find_element_by_name(&quot;email&quot;).clear()
driver.find_element_by_name(&quot;email&quot;).send_keys(&quot;username&quot;)
driver.find_element_by_name(&quot;password&quot;).clear()
driver.find_element_by_name(&quot;password&quot;).send_keys(&quot;password&quot;)
driver.find_element_by_id(&quot;dologin&quot;).click()
driver.switch_to.default_content()

driver.quit()
</code></pre>
<p><code>switch_to.frame()</code> 默认可以直接取表单的id 或name属性。如果iframe没有可用的id和name属性，则可以通过下面的方式进行定位。</p>
<pre><code class="language-python">……
#先通过xpth定位到iframe
xf = driver.find_element_by_xpath('//*[@id=&quot;x-URS-iframe&quot;]')

#再将定位对象传给switch_to.frame()方法
driver.switch_to.frame(xf)
……
driver.switch_to.parent_frame()
</code></pre>
<p>除此之外，在进入多级表单的情况下，还可以通过<code>switch_to.default_content()</code>跳回最外层的页面。</p>
<h3 id="十二-多窗口切换">十二、多窗口切换</h3>
<p>在页面操作过程中有时候点击某个链接会弹出新的窗口，这时就需要主机切换到新打开的窗口上进行操作。WebDriver提供了switch_to.window()方法，可以实现在不同的窗口之间切换。 以百度首页和百度注册页为例，在两个窗口之间的切换如下图。</p>
<pre><code class="language-python">from selenium import webdriver
import time

driver = webdriver.Firefox()
driver.implicitly_wait(10)
driver.get(&quot;http://www.baidu.com&quot;)

# 获得百度搜索窗口句柄
sreach_windows = driver.current_window_handle

driver.find_element_by_link_text('登录').click()
driver.find_element_by_link_text(&quot;立即注册&quot;).click()

# 获得当前所有打开的窗口的句柄
all_handles = driver.window_handles

# 进入注册窗口
for handle in all_handles:
    if handle != sreach_windows:
        driver.switch_to.window(handle)
        print('now register window!')
        driver.find_element_by_name(&quot;account&quot;).send_keys('username')
        driver.find_element_by_name('password').send_keys('password')
        time.sleep(2)
driver.quit()
</code></pre>
<p>在本例中所涉及的新方法如下：</p>
<ul>
<li>current_window_handle：获得当前窗口句柄。</li>
<li>window_handles：返回所有窗口的句柄到当前会话。</li>
<li>switch_to.window()：用于切换到相应的窗口，与上一节的switch_to.frame()类似，前者用于不同窗口的切换，后者用于不同表单之间的切换。</li>
</ul>
<h3 id="十三-警告框处理">十三、警告框处理</h3>
<p>在WebDriver中处理JavaScript所生成的alert、confirm以及prompt十分简单，具体做法是使用 switch_to.alert 方法定位到 alert/confirm/prompt，然后使用text/accept/dismiss/ send_keys等方法进行操作。</p>
<ul>
<li>text：返回 alert/confirm/prompt 中的文字信息。</li>
<li>accept()：接受现有警告框。</li>
<li>dismiss()：解散现有警告框。</li>
<li>send_keys(keysToSend)：发送文本至警告框。keysToSend：将文本发送至警告框。</li>
</ul>
<p>如下图，百度搜索设置弹出的窗口是不能通过前端工具对其进行定位的，这个时候就可以通过switch_to_alert()方法接受这个弹窗。</p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.common.action_chains import ActionChains
import time

driver = webdriver.Firefox()
driver.implicitly_wait(10)
driver.get('http://www.baidu.com')

# 鼠标悬停至“设置”链接
link = driver.find_element_by_link_text('设置')
ActionChains(driver).move_to_element(link).perform()

# 打开搜索设置
driver.find_element_by_link_text(&quot;搜索设置&quot;).click()

# 保存设置
driver.find_element_by_class_name(&quot;prefpanelgo&quot;).click()
time.sleep(2)

# 接受警告框
driver.switch_to.alert.accept()

driver.quit()
</code></pre>
<p>通过switch_to_alert()方法获取当前页面上的警告框，并使用accept()方法接受警告框。</p>
<h3 id="十四-下拉框选择">十四、下拉框选择</h3>
<p>有时我们会碰到下拉框，WebDriver提供了Select类来处理下拉框。 如百度搜索设置的下拉框</p>
<pre><code class="language-python">from selenium import webdriver
from selenium.webdriver.support.select import Select
from time import sleep

driver = webdriver.Chrome()
driver.implicitly_wait(10)
driver.get('http://www.baidu.com')

# 鼠标悬停至“设置”链接
driver.find_element_by_link_text('设置').click()
sleep(1)
# 打开搜索设置
driver.find_element_by_link_text(&quot;搜索设置&quot;).click()
sleep(2)

# 搜索结果显示条数
sel = driver.find_element_by_xpath(&quot;//select[@id='nr']&quot;)
Select(sel).select_by_value('50')  # 显示50条
driver.quit()
</code></pre>
<p>Select类用于定位select标签。</p>
<p>select_by_value() 方法用于定位下接选项中的value值。</p>
<h3 id="十五-文件上传">十五、文件上传</h3>
<p>对于通过input标签实现的上传功能，可以将其看作是一个输入框，即通过<code>send_keys()</code>指定本地文件路径的方式实现文件上传。</p>
<p>创建<code>upfile.html</code>文件，代码如下：</p>
<pre><code class="language-html">&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot; /&gt;
&lt;title&gt;upload_file&lt;/title&gt;
&lt;link href=&quot;http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class=&quot;row-fluid&quot;&gt;
    &lt;div class=&quot;span6 well&quot;&gt;
    &lt;h3&gt;upload_file&lt;/h3&gt;
      &lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/body&gt;
&lt;script src=&quot;http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.js&quot;&gt;&lt;/scrip&gt;
&lt;/html&gt;
</code></pre>
<p>通过浏览器打开upfile.html文件，接下来通过send_keys()方法来实现文件上传。</p>
<pre><code class="language-python">from selenium import webdriver
import os

driver = webdriver.Firefox()
file_path = 'file:///' + os.path.abspath('upfile.html')
driver.get(file_path)

# 定位上传按钮，添加本地文件
driver.find_element_by_name(&quot;file&quot;).send_keys('D:\\upload_file.txt')
driver.quit()
</code></pre>
<h3 id="十六-cookie操作">十六、cookie操作</h3>
<p>有时候我们需要验证浏览器中cookie是否正确，因为基于真实cookie的测试是无法通过白盒和集成测试进行的。</p>
<p>WebDriver提供了操作Cookie的相关方法，可以读取、添加和删除cookie信息。</p>
<p>WebDriver操作cookie的方法：</p>
<ul>
<li><code>get_cookies()</code>： 获得所有cookie信息。</li>
<li><code>get_cookie(name)</code>： 返回字典的key为“name”的cookie信息。</li>
<li><code>add_cookie(cookie_dict)</code> ： 添加cookie。“cookie_dict”指字典对象，必须有name 和value 值。</li>
<li><code>delete_cookie(name,optionsString)</code>：删除cookie信息。“name”是要删除的cookie的名称，“optionsString”是该cookie的选项，目前支持的选项包括“路径”，“域”。</li>
<li><code>delete_all_cookies()</code>： 删除所有cookie信息。</li>
</ul>
<p>下面通过get_cookies()来获取当前浏览器的cookie信息。</p>
<pre><code class="language-python">from selenium import webdriver

driver = webdriver.Firefox()
driver.get(&quot;http://www.youdao.com&quot;)

# 获得cookie信息
cookie= driver.get_cookies()
# 将获得cookie的信息打印
print(cookie)

driver.quit()
</code></pre>
<p>从执行结果可以看出，cookie数据是以字典的形式进行存放的。知道了cookie的存放形式，接下来我们就可以按照这种形式向浏览器中写入cookie信息。</p>
<pre><code class="language-python">from selenium import webdriver

driver = webdriver.Firefox()
driver.get(&quot;http://www.youdao.com&quot;)

# 向cookie的name 和value中添加会话信息
driver.add_cookie({'name': 'key-aaaaaaa', 'value': 'value-bbbbbb'})

# 遍历cookies中的name 和value信息并打印，当然还有上面添加的信息
for cookie in driver.get_cookies():
    print(&quot;%s -&gt; %s&quot; % (cookie['name'], cookie['value']))

driver.quit()
</code></pre>
<p>输出结果：</p>
<p>======================== RESTART: =========================</p>
<pre><code class="language-bash">YOUDAO_MOBILE_ACCESS_TYPE -&gt; 1
_PREF_ANONYUSER__MYTH -&gt; aGFzbG9nZ2VkPXRydWU=
OUTFOX_SEARCH_USER_ID -&gt; -1046383847@218.17.158.115
JSESSIONID -&gt; abc7qSE_SBGsVgnVLBvcu
key-aaaaaaa -&gt; value-bbbbbb
</code></pre>
<p>从执行结果可以看到，最后一条cookie信息是在脚本执行过程中通过add_cookie()方法添加的。通过遍历得到所有的cookie信息，从而找到key为“name”和“value”的特定cookie的value。</p>
<h3 id="十七-调用js代码">十七、调用JS代码</h3>
<p>虽然WebDriver提供了操作浏览器的前进和后退方法，但对于浏览器滚动条并没有提供相应的操作方法。在这种情况下，就可以借助JavaScript来控制浏览器的滚动条。WebDriver提供了<code>execute_script()</code>方法来执行JavaScript代码。</p>
<p>用于调整浏览器滚动条位置的JavaScript代码如下：</p>
<pre><code class="language-javascript">&lt;!-- window.scrollTo(左边距,上边距); --&gt;
window.scrollTo(0,450);
</code></pre>
<p><code>window.scrollTo()</code>方法用于设置浏览器窗口滚动条的水平和垂直位置。方法的第一个参数表示水平的左间距，第二个参数表示垂直的上边距。其代码如下：</p>
<pre><code class="language-python">from selenium import webdriver
from time import sleep

# 访问百度
driver=webdriver.Firefox()
driver.get(&quot;http://www.baidu.com&quot;)

# 设置浏览器窗口大小
driver.set_window_size(500, 500)

# 搜索
driver.find_element_by_id(&quot;kw&quot;).send_keys(&quot;selenium&quot;)
driver.find_element_by_id(&quot;su&quot;).click()
sleep(2)

# 通过javascript设置浏览器窗口的滚动条位置
js=&quot;window.scrollTo(100,450);&quot;
driver.execute_script(js)
sleep(3)

driver.quit()
</code></pre>
<p>通过浏览器打开百度进行搜索，并且提前通过<code>set_window_size()</code>方法将浏览器窗口设置为固定宽高显示，目的是让窗口出现水平和垂直滚动条。然后通过<code>execute_script()</code>方法执行JavaScripts代码来移动滚动条的位置。</p>
<h3 id="十八-窗口截图">十八、窗口截图</h3>
<p>自动化用例是由程序去执行的，因此有时候打印的错误信息并不十分明确。如果在脚本执行出错的时候能对当前窗口截图保存，那么通过图片就可以非常直观地看出出错的原因。WebDriver提供了截图函数<code>get_screenshot_as_file()</code>来截取当前窗口。</p>
<pre><code class="language-python">from selenium import webdriver
from time import sleep

driver = webdriver.Firefox()
driver.get('http://www.baidu.com')

driver.find_element_by_id('kw').send_keys('selenium')
driver.find_element_by_id('su').click()
sleep(2)

# 截取当前窗口，并指定截图图片的保存位置
driver.get_screenshot_as_file(&quot;D:\\baidu_img.jpg&quot;)

driver.quit()
</code></pre>
<p>脚本运行完成后打开D盘，就可以找到<code>baidu_img.jpg</code>图片文件了。</p>
<h3 id="十九-关闭浏览器">十九、关闭浏览器</h3>
<p>在前面的例子中我们一直使用quit()方法，其含义为退出相关的驱动程序和关闭所有窗口。除此之外，WebDriver还提供了close()方法，用来关闭当前窗口。例多窗口的处理，在用例执行的过程中打开了多个窗口，我们想要关闭其中的某个窗口，这时就要用到close()方法进行关闭了。</p>
<ul>
<li>close() 关闭单个窗口</li>
<li>quit() 关闭所有窗口</li>
</ul>
<h3 id="二十-selenium踩坑指北">二十、Selenium踩坑指北</h3>
<blockquote>
<p>众所周知，我们应该把合适的工具用在合适的场景，这跟杀鸡的时候不需要用到宰牛刀是一样的道理。</p>
<p>selenium比较好的使用场景是验收测试/回归测试/TDD/BDD，一些同学喜欢把selenium用到某些selenium难以承受的场景，这种方式官方是不推荐的。下面这些是官方给出的各种神坑。</p>
</blockquote>
<h4 id="验证码">验证码</h4>
<p>一般来说我们不需要用selenium去处理各种验证码，有兴趣的同学可以逆向思维，亲自试试。</p>
<p>那么遇到验证码怎么办？</p>
<ul>
<li>测试环境就关掉验证码</li>
<li>留个后门，比如万能验证码</li>
</ul>
<h4 id="下载文件">下载文件</h4>
<p>尽管我们可以使用selenium去点击下载按钮，从而达到下载文件的目的，但是这样做其实并不好。首先处理起来可能比较麻烦，另外关于下载时间下载速度以及下载完整性的验证我们是不太好做的。</p>
<h4 id="http-请求的响应码">HTTP 请求的响应码</h4>
<p>这一part官方苦口婆心的解释了很多，大意是selenium是站在用户角度去自动化测试，对于终端用户来说，他们并不直接关注请求的返回码，他们关注的是能不能看到404的错误页面之类的可以直接感受到信息。</p>
<p>下面是非官方的建议</p>
<ul>
<li>如果你真的关注响应的状态码，那么别在UI自动化层去做，试着去在非UI层，比如接口层做</li>
<li>放弃在<code>UI</code>自动化用例中断言状态码的努力，有舍才有得嘛</li>
</ul>
<h4 id="第三方登陆">第三方登陆</h4>
<p>使用selenium去自动化第三方登陆原则上是不推荐的。因为</p>
<ul>
<li>增加了用例的复杂度和运行时间，用例容易跑失败</li>
<li>第三方登录是不稳定的，这会让你的登录变得不稳定</li>
</ul>
<p>在国外一般第三方登录的提供方会提供对应的API，我们可以把登录API集成到用例里，这些API相当稳定，比用selenium去自动化登录过程要好。</p>
<p>国内可以通过类似的思路去做，比如微信登录就有自己的API，这种实现比较硬核，并且跟ui自动化结合起来也有一定难度，有需求的同学可以尝试一下。</p>
<h4 id="用例依赖">用例依赖</h4>
<p>selenium team说了，用例直接不要有依赖，要可以用任意顺序运行</p>
<h4 id="性能测试">性能测试</h4>
<p>简而言之，selenium不适合做性能测试，原因我就不详细说了，总之不合适的话咱就不要强求，有情人总会终成眷属。</p>
<p>如果需要做性能测试，可以看看<code>jmeter</code>，官方推荐，值得信赖。</p>
<h4 id="链接爬虫">链接爬虫</h4>
<p>用selenium去遍历一些链接从而达到爬虫的效果官方是不推荐的，理由是慢，有很多更好的替代方案。</p>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">下一篇</div>
                <a href="https://preszang.github.io/post/3oHikQsbE/" class="post-title gt-a-link">
                    pytest接口测试基本教程
                </a>
            </div>
        

        

        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">啦啦啦啦啦啦啦啦啦啦啦啦</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        是谁来自山川湖海，却囿于昼夜、厨房与爱。
    </div>

<!--    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://preszang.github.io/atom.xml" target="_blank">RSS</a></a>
    </div> -->
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

    </div>
</div>
</body>
</html>
